{"version":3,"sources":["/projects/nodejs/botbuilder/mgnlq_model//projects/nodejs/botbuilder/mongoose_record_replay/src/../src/getmodel.ts"],"names":[],"mappings":";;AACA,qCAAqC;AACrC,iEAAiE;AACjE,mCAAmC;AACnC,yCAAyC;AACzC,6CAAiE;AAEjE,IAAI,IAAI,GAAG,QAAQ,CAAC;AACpB,0BAA0B;AAC1B,IAAI,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,4BAA4B,CAAC,KAAK,QAAQ,EAAE;IACpE,IAAI,GAAG,QAAQ,CAAC;CACjB;KAAM,IAAI,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,4BAA4B,CAAC,KAAK,KAAK,EAAE;IACxE,IAAI,GAAG,SAAS,CAAC;CAClB;KAAM,IAAK,CAAC,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,4BAA4B,CAAC;OAC5D,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,4BAA4B,CAAC,KAAK,QAAQ,EAAE;IACpE,IAAI,GAAG,SAAS,CAAC;CAClB;KAAO;IACN,MAAM,IAAI,KAAK,CAAC,iBAAiB,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,4BAA4B,CAAC,SAAU,SAAS,CAAC,4BAA6B,wDAAwD,CAAC,CAAC;CAChM;AAED,IAAI,MAAM,GAAG,SAAS,CAAC,6BAA6B,CAAC,CAAC,+CAA+C;AAErG,IAAI,YAAY,GAAG,sBAAsB,CAAC,kBAAkB,CAAC,QAAQ,EACnE,MAAM,EAAE,mDAAmD;AAC3D,IAAI,CAAC,CAAC;AAER,IAAI,QAAQ,GAAG,SAAS,CAAC;AAEzB,SAAS,SAAS;IAChB,OAAO,mBAAK,CAAC,2BAA2B,CAAC,YAAY,EAAE,SAAS,CAAC,WAAW,EAAE,SAAS,CAAC,UAAU,CAAC,CAAC;AACtG,CAAC;AACD;;;;;GAKG;AACH,SAAgB,YAAY;IAC1B,IAAI,IAAI,KAAK,QAAQ,EAAE;QACrB,iBAAiB;QACjB,kDAAkD;QAClD,QAAQ,GAAG,QAAQ,IAAI,SAAS,EAAE,CAAC;QACnC,OAAO,QAAQ,CAAC;KACjB;IACD,OAAO,SAAS,EAAE,CAAC;AACrB,CAAC;AARD,oCAQC","file":"getmodel.js","sourcesContent":["\r\nimport * as mongoose from 'mongoose';\r\nimport * as mongoose_record_replay from 'mongoose_record_replay';\r\nimport * as process from 'process';\r\nimport * as Constants from './constants';\r\nimport { Model as Model, IFModel as IFModel } from 'mgnlq_model';\r\n\r\nvar mode = 'REPLAY';\r\n// MGNLQ_TESTMODEL2_REPLAY\r\nif (process.env[Constants.ENV_NAME_MONGO_RECORD_REPLAY] === \"RECORD\") {\r\n  mode = 'RECORD';\r\n} else if (process.env[Constants.ENV_NAME_MONGO_RECORD_REPLAY] === \"OFF\") {\r\n  mode = undefined;\r\n} else if ( !process.env[Constants.ENV_NAME_MONGO_RECORD_REPLAY]\r\n || process.env[Constants.ENV_NAME_MONGO_RECORD_REPLAY] === \"REPLAY\") {\r\n  mode = undefined;\r\n} else  {\r\n  throw new Error(`illegal value ${process.env[Constants.ENV_NAME_MONGO_RECORD_REPLAY]}  for ${ Constants.ENV_NAME_MONGO_RECORD_REPLAY }, epxected one of \"REPLAY\", \"RECORD\", \"OFF\" or not set`);\r\n}\r\n\r\nvar mypath = Constants.MONGOOSE_RECORD_REPLAY_FOLDER; // require().resolve('mgnlq_testmodel_replay');\r\n\r\nvar mongooseMock = mongoose_record_replay.instrumentMongoose(mongoose,\r\n  mypath, // 'node_modules/mgnlq_testmodel_replay/mgrecrep/',\r\n  mode);\r\n\r\nvar aPromise = undefined;\r\n\r\nfunction loadModel() {\r\n  return Model.loadModelsOpeningConnection(mongooseMock, Constants.MONGO_DBURL, Constants.MODEL_PATH);\r\n}\r\n/**\r\n * Obtain a model instance,\r\n *\r\n * note: the model must be closed via\r\n * Model.releaseModel(theModelInstance)\r\n */\r\nexport function getTestModel(): Promise<IFModel.IModels> {\r\n  if (mode === 'REPLAY') {\r\n    // determine mode\r\n    // in replax mode, using a singleton is sufficient\r\n    aPromise = aPromise || loadModel();\r\n    return aPromise;\r\n  }\r\n  return loadModel();\r\n}"],"sourceRoot":"ABC"}